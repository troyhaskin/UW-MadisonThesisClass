%<*UserGuide>


%</UserGuide>
%
%
%
%
%
%
%<*Implementation>
%<<Verbatim
%   \iffalse
%<*Code>
%   \fi
%
% \UWModule{Relative Directory Input}
%
%
%
%    \begin{macrocode}
\keys_define:nn { UWMadThesis / RelativeDirectory } {
    chapter-directory-prefix    .tl_gset:N =
        \g__UWMad_RelativeDirectory_Chapter_Prefix_tl,
    chapter-directory-suffix    .tl_gset:N =
        \g__UWMad_RelativeDirectory_Chapter_Suffix_tl,
    section-directory-prefix    .tl_gset:N =
        \g__UWMad_RelativeDirectory_Section_Prefix_tl,
    section-directory-suffix    .tl_gset:N =
        \g__UWMad_RelativeDirectory_Section_Suffix_tl,
    subsection-directory-prefix .tl_gset:N =
        \g__UWMad_RelativeDirectory_Subsection_Prefix_tl,
    subsection-directory-suffix .tl_gset:N =
        \g__UWMad_RelativeDirectory_Subsection_Suffix_tl,
    chapter-directory-prefix    .default:n = ,
    chapter-directory-suffix    .default:n = ,
    section-directory-prefix    .default:n = ,
    section-directory-suffix    .default:n = ,
    subsection-directory-prefix .default:n = ,
    subsection-directory-suffix .default:n = ,
}
\keys_set:nn { UWMadThesis / RelativeDirectory } {
    chapter-directory-prefix,
    chapter-directory-suffix,
    section-directory-prefix,
    section-directory-suffix,
    subsection-directory-prefix,
    subsection-directory-suffix
}

\DeclareDocumentCommand \RelativeDirectorySetup { m } {
    \keys_set:nn { UWMadThesis / RelativeDirectory } { #1 }
}




\tl_new:N  \g__UWMad_RelativeDirectory_Chapter_CurrentPath_tl
\tl_new:N  \g__UWMad_RelativeDirectory_Chapter_CurrentName_tl
\tl_new:N  \g__UWMad_RelativeDirectory_Section_CurrentPath_tl
\tl_new:N  \g__UWMad_RelativeDirectory_Section_CurrentName_tl
\tl_new:N  \g__UWMad_RelativeDirectory_Subsection_CurrentPath_tl
\tl_new:N  \g__UWMad_RelativeDirectory_Subsection_CurrentName_tl
\seq_new:N \g__UWMad_RelativeDirectory_PathStack_seq

\bool_new:N \g__UWMad_RelativeDirectory_IsFileFound_bool

\DeclareDocumentCommand \IncludeChapter { m g } {

    \UWMad_RelativeDirectory_Chapter_UpdatePathStack:n{#1}

    \IfNoValueTF { #2 } {
        \UWMad_RelativeDirectory_InputFile:n {
            \g__UWMad_RelativeDirectory_Chapter_CurrentName_tl
        }
    } {
        \UWMad_RelativeDirectory_InputFile:n {#2}
    }

}

\DeclareDocumentCommand \IncludeSection { m g } {
    \UWMad_RelativeDirectory_Section_UpdatePathStack:n{#1}

    \IfNoValueTF { #2 } {
        \UWMad_RelativeDirectory_InputFile:n {
            \g__UWMad_RelativeDirectory_Section_CurrentName_tl
        }
    } {
        \UWMad_RelativeDirectory_InputFile:n {#2}
    }

}
\DeclareDocumentCommand \IncludeSubsection { m g } {
    \UWMad_RelativeDirectory_Subsection_UpdatePathStack:n{#1}

    \IfNoValueTF { #2 } {
        \UWMad_RelativeDirectory_InputFile:n {
            \g__UWMad_RelativeDirectory_Subsection_CurrentName_tl
        }
    } {
        \UWMad_RelativeDirectory_InputFile:n {#2}
    }
}


\cs_new:Nn \UWMad_RelativeDirectory_Chapter_UpdatePathStack:n {

    \seq_gclear:N \g__UWMad_RelativeDirectory_PathStack_seq

    \tl_gset:Nn \g__UWMad_RelativeDirectory_Chapter_CurrentPath_tl {
        \g__UWMad_RelativeDirectory_Chapter_Prefix_tl
        #1
        \g__UWMad_RelativeDirectory_Chapter_Suffix_tl
    }
    \tl_gset_eq:NN
        \g__UWMad_RelativeDirectory_Chapter_CurrentName_tl
        \g__UWMad_RelativeDirectory_Chapter_CurrentPath_tl
    \seq_gpush:Nn \g__UWMad_RelativeDirectory_PathStack_seq {
        \g__UWMad_RelativeDirectory_Chapter_CurrentPath_tl
    }

}


\cs_new:Nn \UWMad_RelativeDirectory_Section_UpdatePathStack:n {

    \tl_if_blank:NTF \g__UWMad_RelativeDirectory_Section_CurrentName_tl { } {
        \seq_gpop:NN \g__UWMad_RelativeDirectory_PathStack_seq \g_tmpa_seq
    }

    \tl_gset:Nn \g__UWMad_RelativeDirectory_Section_CurrentName_tl {
        \g__UWMad_RelativeDirectory_Section_Prefix_tl
        #1
        \g__UWMad_RelativeDirectory_Section_Suffix_tl
    }
    \tl_if_blank:NTF \g__UWMad_RelativeDirectory_Chapter_CurrentPath_tl {
        \tl_gset_eq:NN
            \g__UWMad_RelativeDirectory_Section_CurrentPath_tl
            \g__UWMad_RelativeDirectory_Section_CurrentName_tl
    } {
        \tl_gset:Nx \g__UWMad_RelativeDirectory_Section_CurrentPath_tl {
            \g__UWMad_RelativeDirectory_Chapter_Suffix_tl
            /
            \g__UWMad_RelativeDirectory_Section_CurrentName_tl
        }
    }
    \seq_gpush:Nn \g__UWMad_RelativeDirectory_PathStack_seq {
        \g__UWMad_RelativeDirectory_Section_CurrentPath_tl
    }
}


\cs_new:Nn \UWMad_RelativeDirectory_Subsection_UpdatePathStack:n {

    \tl_if_blank:NTF \g__UWMad_RelativeDirectory_Subsection_CurrentName_tl { } {
        \seq_gpop:NN \g__UWMad_RelativeDirectory_PathStack_seq \g_tmpa_seq
    }

    \tl_gset:Nn \g__UWMad_RelativeDirectory_Subsection_CurrentName_tl {
        \g__UWMad_RelativeDirectory_Subsection_Prefix_tl
        #1
        \g__UWMad_RelativeDirectory_Subsection_Suffix_tl
    }
   \tl_if_blank:NTF \g__UWMad_RelativeDirectory_Section_CurrentPath_tl {
        \tl_gset_eq:NN
            \g__UWMad_RelativeDirectory_Subsection_CurrentPath_tl
            \g__UWMad_RelativeDirectory_Subsection_CurrentName_tl
    } {
        \tl_gset:Nn \g__UWMad_RelativeDirectory_Subsection_CurrentPath_tl {
            \g__UWMad_RelativeDirectory_Section_Suffix_tl
            /
            \g__UWMad_RelativeDirectory_Subsection_CurrentName_tl
        }
    }

    \seq_gpush:Nn \g__UWMad_RelativeDirectory_PathStack_seq {
        \g__UWMad_RelativeDirectory_Subsection_CurrentPath_tl
    }
}


\cs_new:Nn \UWMad_RelativeDirectory_InputFile:n {
    \bool_set_false:N \g__UWMad_RelativeDirectory_IsFileFound_bool
    
    \seq_map_inline:Nn \g__UWMad_RelativeDirectory_PathStack_seq {
        \bool_if:NTF \g__UWMad_RelativeDirectory_IsFileFound_bool { } {
            \file_path_include:n{./##1/}
            \file_if_exist:nTF {##1/#1} {
                \file_input:n{##1/#1}
                \bool_set_true:N \g__UWMad_RelativeDirectory_IsFileFound_bool
            } { }
            \file_path_remove:n{./##1/}
        }
    }

    \bool_if:NTF \g__UWMad_RelativeDirectory_IsFileFound_bool { } {
        \typeout{******************** FILE NOT FOUND *******************}
    }
}


%    \end{macrocode}
%
%   \iffalse
%</Code>
%   \fi
%Verbatim
%</Implementation>